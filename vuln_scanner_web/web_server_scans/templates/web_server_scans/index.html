<!-- network_scans/templates/network_scans/home.html -->
{% extends "base.html" %}

{% block title %}
Web Server Scans
{% endblock %}

{% block content %}
<div class="web-server-page">
    <form method="post" class="border bg-white" style="display:flex; flex-direction: column;">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" name="check_server_software" class="btn btn-dark">Check Server Software</button>
        <button type="submit" name="directory_traversal" class="btn btn-dark">Directory Traversal</button>
        <button type="submit" name="wordpress_bruteforce" class="btn btn-dark">Wordpress Bruteforce</button>
        <button type="submit" name="detect_admin_pages" class="btn btn-dark">Detect Admin Interface</button>
        <button type="submit" name="certificate_check" class="btn btn-dark">Certificate Check</button>
        <!-- Add more buttons as needed -->
    </form>

    {% if server_software_result %}
    <div class="web-server-result border bg-white">
        <h2>Server Software Check Results</h2>
        <table class="table">
            <thead class="thead-light">
                <tr>
                    <th scope="col"></th>
                    <th scope="col">Value</th>
                </tr>
            </thead>
            <tr>
            <th scope="row">Software</th>
            <td class="code">{{ server_software_result.software|default:"Not available" }}</td>
            </tr>
            <tr>
            <th scope="row">Version</th>
            <td>{{ server_software_result.version|default:"Not available" }}</td>
            </tr>
            <tr>
                <th scope="row">Full Version</th>
                <td>{{ server_software_result.full_version|default:"Not available" }}</td>
            </tr>
            <tr>
                <th scope="row">Release Date</th>
                <td>{{ server_software_result.release_date|default:"Not available" }}</td>
            </tr>
            <tr>
            <th  scope="row">Latest Version</th>
            <td>{{ server_software_result.latest_version|default:"Not available" }}</td>
            </tr>
            <tr>
            <th scope="row">Latest Version Date</th>
            <td>{{ server_software_result.latest_version_date|default:"Not available" }}</td>
            </tr>
            <tr>
            <th scope="row">Status</th>
            <td>{{ server_software_result.status|default:"Not available" }}</td>
            </tr>
            {% if server_software_result.error %}
            <tr>
            <th scope="row">Error</th>
            <td>{{ server_software_result.error }}</td>
            </tr>
            {% endif %}
        </table> 
    </div>
    {% endif %}
    <div class="web-server-result border bg-white" style="visibility:hidden" id="results">
    </div>
    {% if task_id_dir_trav %}
        <script>
            const taskId = "{{ task_id_dir_trav }}";
            const resultsDiv = document.getElementById('results');

            function fetchResults() {
                fetch(`/web_server_scans/dir_trav/${taskId}`)
                    .then(response => response.json())
                    .then(data => {
                        resultsDiv.style.visibility = "visible"
                        if (data.complete) {
                            console.log(data.results)
                            // resultsDiv.innerHTML = data.results; // Assuming 'results' is the output
                            if (Array.isArray(data.results) && (data.results.length > 0)) {
                                // Construct an unordered list from the results array
                                const listItems = data.results.map(item => `<h3>Directories</h3><li><a style="unset: all;" target="_blank" href="${item}">${item}</a></li>`).join('');
                                resultsDiv.innerHTML = `<ul>${listItems}</ul>`;
                            } else {
                                resultsDiv.innerHTML = `<h3>Directories</h3><p>No results found</p>`
                            }
                            clearInterval(pollingInterval); // Stop polling
                        } else {
                            resultsDiv.innerHTML = data.results; // Display ongoing task message
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }

            // Poll every 5 seconds
            const pollingInterval = setInterval(fetchResults, 5000);
        </script>
    {% endif %}
    <div class="web-server-result border bg-white" style="visibility:hidden" id="results">
    </div>
    {% if task_id_wp_bf %}
        <script>
            const taskId = "{{ task_id_wp_bf }}";
            const resultsDiv = document.getElementById('results');

            function fetchResults() {
                fetch(`/web_server_scans/bf_wp/${taskId}`)
                    .then(response => response.json())
                    .then(data => {
                        resultsDiv.style.visibility = "visible"
                        if (data.complete) {
                            console.log(data.results)
                            // resultsDiv.innerHTML = data.results; // Assuming 'results' is the output
                            if (Array.isArray(data.results) && (data.results.length > 0)) {
                                // Construct an unordered list from the results array
                                const listItems = data.results.map(item => `<h3>Password found:</h3><li><a style="unset: all;" target="_blank" href="${item}">${item}</a></li>`).join('');
                                resultsDiv.innerHTML = `<ul>${listItems}</ul>`;
                            } else {
                                resultsDiv.innerHTML = `<h3>Wordpress Bruteforce result:</h3><p>No results found</p>`
                            }
                            clearInterval(pollingInterval); // Stop polling
                        } else {
                            resultsDiv.innerHTML = data.results; // Display ongoing task message
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }

            // Poll every 5 seconds
            const pollingInterval = setInterval(fetchResults, 5000);
        </script>
    {% endif %}
    {% if admin_pages_result.exposed_admin_paths %}
        <div class="web-server-result border bg-white">
            <h3>Detected Admin Pages</h3>
            <ul>
                {% for path in admin_pages_result.exposed_admin_paths %}
                    <li>{{ path }}</li>
                {% empty %}
                    <li>No exposed admin pages detected.</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
    {% if cert_report %}
        <div class="web-server-result border bg-white">
            <h3>Certificate Details</h3>
            <p><strong>Timestamp:</strong> {{ cert_report.Timestamp }}</p>
            <p><strong>Target:</strong> {{ cert_report.Result.target }}</p>

            <p><strong>Issuer:</strong></p>
            <ul>
                {% for issuer_group in cert_report.Result.issuer %}
                    {% for issuer in issuer_group %}
                        <li>{{ issuer.0 }}: {{ issuer.1 }}</li>
                    {% endfor %}
                {% endfor %}
            </ul>

            <p><strong>Subject:</strong></p>
            <ul>
                {% for subject_group in cert_report.Result.subject %}
                    {% for subject in subject_group %}
                        <li>{{ subject.0 }}: {{ subject.1 }}</li>
                    {% endfor %}
                {% endfor %}
            </ul>

            <p><strong>Expiration Date:</strong> {{ cert_report.Result.expiration_date }}</p>
            <p><strong>Expired:</strong> {{ cert_report.Result.expired }}</p>
        </div>
    {% endif %}

</div>
{% endblock %}
