<!-- network_scans/templates/network_scans/home.html -->
{% extends "base.html" %}

{% block title %}
Web Server Scans
{% endblock %}

{% block content %}
<div class="web-server-page">
    <form method="post" class="border bg-white">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" name="check_server_software" class="btn btn-dark">Check Server Software</button>
        <button type="submit" name="directory_traversal" class="btn btn-dark">Directory Traversal</button>
        <!-- Add more buttons as needed -->
    </form>

    {% if result %}
    <div class="web-server-result border bg-white">
        <h2>Server Software Check Results</h2>
        <table class="table">
            <thead class="thead-light">
                <tr>
                    <th scope="col"></th>
                    <th scope="col">Value</th>
                </tr>
            </thead>
            <tr>
            <th scope="row">Software</th>
            <td class="code">{{ result.software|default:"Not available" }}</td>
            </tr>
            <tr>
            <th scope="row">Version</th>
            <td>{{ result.version|default:"Not available" }}</td>
            </tr>
            <tr>
                <th scope="row">Full Version</th>
                <td>{{ result.full_version|default:"Not available" }}</td>
            </tr>
            <tr>
                <th scope="row">Release Date</th>
                <td>{{ result.release_date|default:"Not available" }}</td>
            </tr>
            <tr>
            <th  scope="row">Latest Version</th>
            <td>{{ result.latest_version|default:"Not available" }}</td>
            </tr>
            <tr>
            <th scope="row">Latest Version Date</th>
            <td>{{ result.latest_version_date|default:"Not available" }}</td>
            </tr>
            <tr>
            <th scope="row">Status</th>
            <td>{{ result.status|default:"Not available" }}</td>
            </tr>
            {% if result.error %}
            <tr>
            <th scope="row">Error</th>
            <td>{{ result.error }}</td>
            </tr>
            {% endif %}
        </table> 
    </div>
    {% endif %}
    <div class="web-server-result border bg-white" id="results">
    </div>
    {% if task_id %}
        <script>
            const taskId = "{{ task_id }}";
            const resultsDiv = document.getElementById('results');

            function fetchResults() {
                fetch(`/web_server_scans/dir_trav/${taskId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.complete) {
                            console.log(data.results)
                            resultsDiv.innerHTML = data.results; // Assuming 'results' is the output
                            clearInterval(pollingInterval); // Stop polling
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }

            // Poll every 5 seconds
            const pollingInterval = setInterval(fetchResults, 5000);
        </script>
    {% endif %}
</div>
{% endblock %}
